@model GameViewModel

@{
    ViewData["Title"] = "Detail";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var words = Model.GameName.Split(' ');
}

<div class="container mt-4">
    <div class="row">
        <!-- Left Side: Image Carousel -->
        <div class="col-lg-8">
            <section class="hero">
                <div class="container">
                    <div class="hero__slider owl-carousel">
                        @foreach (var image in Model.Images.Where(i => i.ImageType == "display"))
                        {
                            <div class="hero__items set-bg" data-setbg="@Url.Content(image.ImageUrl)">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="hero__text">
                                            <h2 class="text-shadow fw-bold">@Model.GameName</h2>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </section>

            <!-- Game Description -->
            <div class="game-description mt-4">
                <h2 class="text-white mb-3">Description</h2>
                <p class="text-white">@Model.Description</p>
            </div>

            <!-- System Requirements -->
            <div class="system-requirements mt-5 p-4" style="background-color: #1e1e1e; border-radius: 8px;">
                <h2 class="text-white mb-3">
                    @if (words.Length > 1)
                    {
                        <span>@string.Join(" ", words.Take(words.Length / 2))</span>
                        <span class="text-primary">@string.Join(" ", words.Skip(words.Length / 2))</span>
                    }
                    else
                    {
                        <span>@Model.GameName</span>
                    }
                    System Requirements
                </h2>
                
                <hr style="border-color: #007bff;">
                <div class="platform-section text-white mt-4">
                    <h4>Recommended</h4>
                    <ul class="list-unstyled">
                        <li class="mb-3">
                            
                            <ul class="list-unstyled ml-4 mt-2">
                                <li><span style="color: #b0b0b0;">OS version</span> <div style="padding-left: 20px;">@Model.SystemRequirement?.OS</div></li>
                                <li><span style="color: #b0b0b0;">Processor</span> <div style="padding-left: 20px;">@Model.SystemRequirement?.SystemProcessor</div></li>
                                <li><span style="color: #b0b0b0;">Memory</span> <div style="padding-left: 20px;">@Model.SystemRequirement?.SystemMemory</div></li>
                                <li><span style="color: #b0b0b0;">Graphics</span> <div style="padding-left: 20px;">@Model.SystemRequirement?.Graphics</div></li>
                                <li><span style="color: #b0b0b0;">Storage</span> <div style="padding-left: 20px;">@Model.SystemRequirement?.Storage</div></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Right Side: Game Info and Purchase Options -->
        <div class="col-lg-4">
            <div class="game-info">
                <h1 class="text-white mb-3">@Model.GameName</h1>
                <div class="price-section mb-4">
                    @if (Model.Discount > 0)
                    {
                        <div class="original-price text-decoration-line-through text-muted">@Model.Price.ToString("C")</div>
                        <div class="discounted-price text-danger">@(((decimal)Model.Price * (decimal)(1 - (decimal)Model.Discount / 100)).ToString("C"))</div>
                    }
                    else if (Model.Price == 0)
                    {
                        <div class="price text-success">Free</div>
                    }
                    else
                    {
                        <div class="price text-white">@Model.Price.ToString("C")</div>
                    }
                </div>

                <!-- Conditionally display "In Library" or "Add to Cart" -->
                @if (Model.IsInLibrary)
                {
                    <button class="btn btn-success btn-lg w-100 mb-3" disabled>In Library</button>
                }
                else
                {
                    <form action="@Url.Action("AddToCart", "Cart")" method="post">
                        <input type="hidden" name="gameId" value="@Model.Id" />
                        <input type="hidden" name="price" value="@(((decimal)Model.Price * (decimal)(1 - (decimal)Model.Discount / 100)))" />
                        <button type="submit" class="btn btn-primary btn-lg w-100 mb-3">Add to Cart</button>
                    </form>
                }

                <div class="details-list">
                    <ul class="list-unstyled text-white">
                        <li><strong>Developer:</strong> @Model.Developer</li>
                        <li><strong>Publisher:</strong> @Model.Publisher?.Name</li>
                        <li><strong>Category:</strong> @Model.Category?.Name</li>
                        <li><strong>Release Date:</strong> @Model.CreatedDate.ToString("MM/dd/yyyy")</li>
                        <li><strong>Platform:</strong> @Model.Platform</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- User Reviews -->
    <div class="mt-5 text-white">
        <h4>User Reviews</h4>
        @foreach (var review in Model.Reviews)
        {
            <div class="review mb-4">
                <div>
                    @for (int i = 0; i < review.Rating; i++)
                    {
                        <span class="fa fa-star checked text-warning"></span>
                    }
                    @for (int i = review.Rating; i < 5; i++)
                    {
                        <span class="fa fa-star text-muted"></span>
                    }
                </div>
                @if (!string.IsNullOrEmpty(review.CustomerReview))
                {
                    <p class="text-white mt-2">@review.CustomerReview</p>
                }
            </div>
        }

        <!-- Add Review Form -->
        <h5 class="text-white">Add Your Review</h5>
        <form asp-action="AddReview" method="post">
            <div class="form-group">
                <label class="text-white">Stars</label>
                <select class="form-control" name="Rating">
                    @for (int i = 1; i <= 5; i++)
                    {
                        <option value="@i">@i Star@(i > 1 ? "s" : "")</option>
                    }
                </select>
            </div>
            <div class="form-group mt-2">
                <label class="text-white">Comment (optional)</label>
                <textarea class="form-control" name="CustomerReview" rows="3"></textarea>
            </div>
            <button type="submit" class="btn btn-primary mt-3">Submit Review</button>
        </form>
    </div>
</div>

@section Scripts {
    <script src="https://kit.fontawesome.com/a076d05399.js"></script> <!-- For star icons -->
}
