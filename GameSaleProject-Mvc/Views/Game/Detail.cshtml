@model GameViewModel

@{
    ViewData["Title"] = "Detail";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-4">
    <div class="row">
        <!-- Left Side: Image Carousel -->
        <div class="col-md-8">
            <section class="hero">
                <div class="container">
                    <div class="hero__slider owl-carousel">
                        @foreach (var image in Model.Images.Where(i => i.ImageType == "display"))
                        {
                            <div class="hero__items set-bg" data-setbg="@Url.Content(image.ImageUrl)">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="hero__text">
                                            <h2 class="text-shadow fw-bold">@Model.GameName</h2>
                                            <p class="text-shadow">@Model.Description</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </section>
        </div>

        <!-- Right Side: Card Image and Game Info -->
        <div class="col-md-4">
            <div class="card text-white bg-dark mb-3">
                <img src="@Url.Content(Model.Images.FirstOrDefault(i => i.ImageType == "card")?.ImageUrl ?? "/images/placeholder.png")" class="card-img-top" alt="@Model.GameName">
                <div class="card-body">
                    <h5 class="card-title">@Model.GameName</h5>
                    <p class="card-text">
                        @if (Model.Price == 0)
                        {
                            <span class="text-success">Free</span>
                        }
                        @if (Model.Discount > 0)
                        {
                            <span class="text-decoration-line-through">@Model.Price.ToString("C")</span>
                            <span class="text-danger">@(((decimal)Model.Price * (decimal)(1 - (decimal)Model.Discount / 100)).ToString("C"))</span>
                        }
                        else if (Model.Price != 0)
                        {
                            <span>@Model.Price.ToString("C")</span>
                        }
                    </p>

                    <!-- Conditionally display "In Library" or "Add to Cart" -->
                    @if (Model.IsInLibrary)
                    {
                        <button class="btn btn-success" disabled>In Library</button>
                    }
                    else
                    {
                        <!-- Add to Cart Button -->
                        <form action="@Url.Action("AddToCart", "Cart")" method="post" style="display:inline;">
                            <input type="hidden" name="gameId" value="@Model.Id" />
                            <input type="hidden" name="price" value="@(((decimal)Model.Price * (decimal)(1 - (decimal)Model.Discount / 100)))" />
                            <button type="submit" class="btn btn-primary">Add to Cart</button>
                        </form>
                    }
                    <ul class="list-group list-group-flush mt-3 bg-dark">
                        <li class="list-group-item bg-dark"><strong>Developer:</strong> @Model.Developer</li>
                        <li class="list-group-item bg-dark"><strong>Publisher:</strong> @Model.Publisher?.Name</li>
                        <li class="list-group-item bg-dark"><strong>Category:</strong> @Model.Category?.Name</li>
                        <li class="list-group-item bg-dark"><strong>Release Date:</strong> @Model.CreatedDate.ToString("MM/dd/yyyy")</li>
                        <li class="list-group-item bg-dark"><strong>Platform:</strong> @Model.Platform</li>
                    </ul>
                </div>
            </div>

            <!-- System Requirements -->
            <div class="card mt-4 text-white bg-dark">
                <div class="card-header">
                    System Requirements
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush bg-dark">
                        <li class="list-group-item bg-dark"><strong>OS:</strong> @Model.SystemRequirements?.OS</li>
                        <li class="list-group-item bg-dark"><strong>Processor:</strong> @Model.SystemRequirements?.SystemProcessor</li>
                        <li class="list-group-item bg-dark"><strong>Memory:</strong> @Model.SystemRequirements?.SystemMemory</li>
                        <li class="list-group-item bg-dark"><strong>Graphics:</strong> @Model.SystemRequirements?.Graphics</li>
                        <li class="list-group-item bg-dark"><strong>Storage:</strong> @Model.SystemRequirements?.Storage</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- User Reviews -->
    <div class="mt-5 text-white">
        <h4>User Reviews</h4>
        @foreach (var review in Model.Reviews)
        {
            <div class="mb-3">
                <div>
                    @for (int i = 0; i < review.Rating; i++)
                    {
                        <span class="fa fa-star checked"></span>
                    }
                    @for (int i = review.Rating; i < 5; i++)
                    {
                        <span class="fa fa-star"></span>
                    }
                </div>
                @if (!string.IsNullOrEmpty(review.CustomerReview))
                {
                    <p>@review.CustomerReview</p>
                }
            </div>
        }

        <!-- Add Review Form -->
        <h5>Add Your Review</h5>
        <form asp-action="AddReview" method="post">
            <div class="form-group">
                <label>Stars</label>
                <select class="form-control" name="Rating">
                    @for (int i = 1; i <= 5; i++)
                    {
                        <option value="@i">@i Star@(i > 1 ? "s" : "")</option>
                    }
                </select>
            </div>
            <div class="form-group mt-2">
                <label>Comment (optional)</label>
                <textarea class="form-control" name="CustomerReview" rows="3"></textarea>
            </div>
            <button type="submit" class="btn btn-primary mt-2">Submit Review</button>
        </form>
    </div>
</div>

@section Scripts {
    <script src="https://kit.fontawesome.com/a076d05399.js"></script> <!-- For star icons -->
}
